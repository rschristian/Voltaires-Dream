#Castilian Missions
#by Isildur

vn_cas_missions_slot_1_a = {
	slot = 1
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_patronize_holy_orders = {
		icon = shield_of_christendom
		#completed_by = 1172.1.1
		required_missions = {  }
		provinces_to_highlight = {
			if = {
				limit = { has_dlc = "Golden Century" }
				has_holy_order_trigger = no
			}
			else = {
				OR = {
					NOT = { religion = ROOT }
					NOT = { base_manpower = 3 }
				}
			}
			owned_by = ROOT
		}
		trigger = {
			NOT = { current_age = age_of_empire }
			if = {
				limit = {
					OR = {
						current_age = age_of_empire
						has_estate = estate_holy_orders
					}
				}
				estate_loyalty = {
					estate = estate_holy_orders
					loyalty = 60
				}
				num_of_estate_privileges = {
					estate = estate_holy_orders
					value = 3
				}
			}
			else = {
				NOT = { has_estate = estate_holy_orders }
			}
			if = {
				limit = { 
					has_dlc = "Golden Century"
					OR = {
						religion = catholic
						religion = catholique
					}
				}
				num_of_owned_provinces_with = {
					has_holy_order_trigger = yes
					value = 50
				}
			}
			else = {
				num_of_owned_provinces_with = {
					base_manpower = 3
					religion = ROOT
					value = 50
				}
			}
		}
		effect = {
			add_papal_influence = 10
			add_country_modifier = {
				name = "cas_patronize_holy_orders_mission"
				duration = 9125
			}
		}
	}
	vn_cas_cortes_of_castile = {
		icon = mission_noble_council
		#completed_by = 1188.1.1
		required_missions = { vn_cas_patronize_holy_orders }
		provinces_to_highlight = {
			OR = {
				province_id = 844
				province_id = 519
				province_id = 4328
				province_id = 2160
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		trigger = {
			has_3_advisors_trigger = yes
			employed_advisor = {
				culture = leonese
			}
			OR = {
				employed_advisor = {
					culture = galician
				}
				employed_advisor = {
					culture = basque
				}
			}
			owns_core_province = 844
			owns_core_province = 519
			OR = {
				owns_core_province = 4328
				owns_core_province = 2160
			}
		}
		effect = {
			add_corruption = -2
			add_country_modifier = {
				name = "cas_cortes_of_castile_mission"
				duration = 9125
			}
		}
	}
	vn_cas_establish_mesta = {
		icon = mission_trade_company_region_abroad
		#completed_by = 1273.1.1
		required_missions = { vn_cas_cortes_of_castile }
		position = 4
		trigger = {
			wool = 5
			any_owned_province = {
				trade_goods = wool
				development = 10
			}
		}
		effect = {
			#Honrado Concejo de la Mesta
			every_owned_province = {
				limit = { 
					superregion = iberia_superregion
					trade_goods = wool 
				}
				add_base_production = 2
				add_province_modifier = {
					name = "cas_establish_mesta_mission"
					duration = 9125
				}
			}
		}
	}
}

vn_cas_missions_slot_1_b = {
	slot = 1
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_dynastic_claims = {
		icon = spa_infantes_aragon
		completed_by = 1072.1.1
		required_missions = { }
		position = 5
		trigger = {
			custom_trigger_tooltip = {
				tooltip = vn_cas_dynastic_claims.tt
				has_global_flag = lon_split_flag
			}
			stability = 1
			is_free_or_tributary_trigger = yes
			if = {
				limit = { government = monarchy }
				num_of_royal_marriages = 2
				legitimacy = 100
			}
			else = {
				num_of_allies = 2
			}
		}
		effect = {
			add_stability_or_adm_power = yes
			if = {
				limit = {
					tag = CAS
				}
				leonese_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
				asturian_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
			else_if = {
				limit = {
					tag = LON
				}
				castile_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
				asturian_region = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
		}
	}
	vn_cas_subjugate_galicia = {
		icon = a_question_of_spain
		completed_by = 1072.1.1
		required_missions = { vn_cas_dynastic_claims }
		provinces_to_highlight = {
			OR = {
				area = galicia_area
				area = ourense_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			OR = {
				NOT = { exists = GAL }
				GAL = { is_subject_of = ROOT }
			}
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				OR = {
					area = galicia_area
					area = ourense_area
				}
			}
		}
		effect = {
			add_prestige_or_monarch_power = { amount = 10 } 
			add_adm_power = 25
			# galicia_area = {
			#	 limit = { NOT = { is_core = GAL } }
			#	 add_core = GAL
			# }
			# ourense_area = {
			#	 limit = { NOT = { is_core = GAL } }
			#	 add_core = GAL
			# }
			galicia_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_subjugate_galicia_mission"
					duration = 1825
				}
			}
			ourense_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_subjugate_galicia_mission"
					duration = 1825
				}
			}
		}
	}
	vn_cas_crown_of_castile = {
		icon = mission_castillian_aggression
		completed_by = 1301.1.1
		required_missions = { 
			vn_cas_subjugate_galicia
			vn_cas_subjugate_leon 
		}
		provinces_to_highlight = {
			OR = {
				province_id = 519
				province_id = 844
				province_id = 4328
				province_id = 1208
				province_id = 267
				province_id = 74
				province_id = 1867
				province_id = 2670
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		trigger = {
			government_rank = 5
			if = {
				limit = { has_dlc = "Common Sense" }
				legitimacy_equivalent = 90
			}
			else_if = {
				limit = { government = monarchy }
				legitimacy = 90
			}
			owns_core_province = 519
			owns_core_province = 844
			owns_core_province = 4328
			owns_core_province = 1208
			owns_core_province = 267
			owns_core_province = 74
			owns_core_province = 1867
			owns_core_province = 2670
			custom_trigger_tooltip = {
				tooltip = vn_cas_crown_of_castile.tt
				OR = {
					has_country_flag = had_cas_civil_war
					current_age = age_of_reformation
					current_age = age_of_absolutism
					current_age = age_of_revolutions
					current_age = age_of_ideology
				}
			}
		}
		effect = {
			soria_area = {
				limit = { owned_by = ROOT }
				add_province_modifier = {
					name = "cas_crown_of_castile_mission"
					duration = 7300
				}
			}
			leon_area = {
				limit = { owned_by = ROOT }
				add_province_modifier = {
					name = "cas_crown_of_castile_mission"
					duration = 7300
				}
			}
			galicia_area = {
				limit = { owned_by = ROOT }
				add_province_modifier = {
					name = "cas_crown_of_castile_mission"
					duration = 7300
				}
			}
			1208 = {
				move_capital_effect = yes
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
			aragon_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			catalunya_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			valencian_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			beiras_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			alentejo_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
		}
	}
	vn_cas_subjugate_aragon = {
		icon = king_of_aragon
		completed_by = 1479.9.4
		required_missions = { vn_cas_crown_of_castile }
		provinces_to_highlight = {
			OR = {
				region = aragon_region
				region = catalunya_region
				region = valencian_region
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			aragon_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			catalunya_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			valencian_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		effect = {
			add_prestige_or_monarch_power = { amount = 20 } 
			add_mil_power = 75
			add_country_modifier = {
				name = "ara_iberian_wedding_mission"
				duration = 9125
			}
			# aragon_region = {
			# 	limit = { NOT = { is_core = ARA } }
			# 	add_core = ARA
			# }
			# catalunya_region = {
			# 	limit = { NOT = { is_core = CAT } }
			# 	add_core = CAT
			# }
			# valencia_area = {
			# 	limit = { NOT = { is_core = AVL } }
			# 	add_core = AVL
			# }
			# denia_area = {
			# 	limit = { NOT = { is_core = AVL } }
			# 	add_core = AVL
			# }
			balears_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	vn_cas_invade_baleares = {
		icon = mission_invade_island
		completed_by = 1479.9.4
		required_missions = { vn_cas_subjugate_aragon }
		position = 9
		provinces_to_highlight = {
			area = balears_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 6
                area = balears_area
			}
		}
		effect = {
			# balears_area = {
			# 	limit = { NOT = { is_core = MJO } }
			# 	add_core = MJO
			# }
			sassari_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			arborea_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			gallura_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}	
	}
}

vn_cas_missions_slot_2_a = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_extremadura_campaign = {
		icon = dom_ara_remensa_war
		completed_by = 1243.1.1
		required_missions = { vn_cas_prepare_reconquista }
		position = 2
		provinces_to_highlight = {
			region = extremadura_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				region = extremadura_region
			}
		}
		effect = {
			create_general_with_pips = {
				tradition = 40
				add_shock = 1
			}
			# caceres_area = {
			# 	limit = { NOT = { is_core = LON } }
			# 	add_core = LON
			# }
			# badajoz_area = {
			# 	limit = { NOT = { is_core = LON } }
			# 	add_core = LON
			# }
			# plasencia_area = {
			# 	limit = { NOT = { is_core = CTL } }
			# 	add_core = CTL
			# }
			huelva_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			sevilla_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			} 
		}
	}
	vn_cas_claim_sevilla = {
		icon = spa_dominate_sevilla
		 completed_by = 1264.9.22
		required_missions = { vn_cas_extremadura_campaign }
		position = 4
		provinces_to_highlight = {
			OR = {
				area = huelva_area
				area = sevilla_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				OR = {
					area = huelva_area
					area = sevilla_area
				}
			}
		}
		effect = {
			# huelva_area = {
			# 	limit = { NOT = { is_core = CSE } }
			# 	add_core = CSE
			# }
			# sevilla_area = {
			# 	limit = { NOT = { is_core = CSE } }
			# 	add_core = CSE
			# }
			1867 = {
				add_province_modifier = {
					name = "cas_claim_sevilla_mission"
					duration = 9125
				}
			}
		}
	}
}

vn_cas_missions_slot_2_b = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_subjugate_leon = {
		icon = mission_unite_home_region	#placeholder
		completed_by = 1085.1.1
		required_missions = { vn_cas_dynastic_claims }
		position = 6
		provinces_to_highlight = {
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = CAS
							was_tag = CAS
						}
					}
				}
				OR = {
					region = leonese_region
					area = asturias_area
				}
			}
			else_if = {
				limit = {
					ROOT = {
						OR = {
							tag = LON
							was_tag = LON
						}
					}
				}
				region = castile_region
			}
			else = {
				OR = {
					region = leonese_region
					region = castile_region
					area = asturias_area
				}
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			if = {
				limit = {
					OR = {
						tag = CAS
						was_tag = CAS
					}
				}
				OR = {
					NOT = { exists = LON }
					LON = { is_subject_of = ROOT }
				}
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 12
					OR = {
						region = castile_region
						area = asturias_area
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						tag = LON
						was_tag = LON
					}
				}
				OR = {
					NOT = { exists = CAS }
					CAS = { is_subject_of = ROOT }
				}
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 8
					region = castile_region
				}
			}
			else = {
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 20
					OR = {
						region = leonese_region
						region = castile_region
						area = asturias_area
					}
				}
			}
		}
		effect = {
			add_prestige_or_monarch_power = { amount = 10 } 
			add_adm_power = 25
			if = {
				limit = {
					OR = {
						tag = CAS
						was_tag = CAS
					}
				}
				# leonese_region = {
				#	 limit = { NOT = { is_core = LON } }
				#	 add_core = LON
				# }
				# asturias_area = {
				#	 limit = { NOT = { is_core = ASU } }
				#	 add_core = ASU
				# }
				leonese_region = {
					limit = { country_or_non_sovereign_subject_holds = ROOT }
					add_province_modifier = {
						name = "cas_subjugate_galicia_mission"
						duration = 1825
					}
				}
				asturias_area = {
					limit = { country_or_non_sovereign_subject_holds = ROOT }
					add_province_modifier = {
						name = "cas_subjugate_galicia_mission"
						duration = 1825
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						tag = LON
						was_tag = LON
					}
				}
				# castile_region = {
				#	 limit = { NOT = { is_core = CAS } }
				#	 add_core = CAS
				# }
				castile_region = {
					limit = { country_or_non_sovereign_subject_holds = ROOT }
					add_province_modifier = {
						name = "cas_subjugate_galicia_mission"
						duration = 1825
					}
				}
			}
			else = {
				leonese_region = {
					limit = { country_or_non_sovereign_subject_holds = ROOT }
					add_province_modifier = {
						name = "cas_subjugate_galicia_mission"
						duration = 1825
					}
				}
				castile_region = {
					limit = { country_or_non_sovereign_subject_holds = ROOT }
					add_province_modifier = {
						name = "cas_subjugate_galicia_mission"
						duration = 1825
					}
				}
				asturias_area = {
					limit = { country_or_non_sovereign_subject_holds = ROOT }
					add_province_modifier = {
						name = "cas_subjugate_galicia_mission"
						duration = 1825
					}
				}
			}
		}
	}
}

vn_cas_missions_slot_2_c = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_school_of_salamanca = {
		icon = hispanic_monarchy
		completed_by = 1550.1.1
		required_missions = { vn_cas_triumph_over_islam }
		position = 7
		provinces_to_highlight = {
			province_id = 2718
		}
		trigger = {
			owns_core_province = 2718
			2718 = {
				development = 20
				has_education_building_trigger = yes 
			}
		}
		effect = {
			add_innovativeness_big_effect = yes
			add_country_modifier = {
				name = "cas_school_of_salamanca_mission"
				duration = 10950
			}
		}
	}
}

vn_cas_missions_slot_2_d = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_portuguese_question = {
		icon = mission_union_with_portugal
		completed_by = 1580.8.26
		required_missions = { vn_cas_crown_of_castile }
		position = 8
		provinces_to_highlight = {
			OR = {
				region = beiras_region
				region = alentejo_region
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			OR = {
				AND = {
					alliance_with = POR
					marriage_with = POR
					reverse_has_opinion = {
						who = POR
						value = 150
					}
				}
				AND = {
					beiras_region = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT
					}
					alentejo_region = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
			}
		}
		effect = {
			add_prestige_or_monarch_power = { amount = 10 } 
			if = {
				limit = {
					beiras_region = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT
					}
					alentejo_region = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
				add_country_modifier = {
					name = "ara_aragonese_portugal_mission"
					duration = 9125
				}
			}
			else = {
				add_dip_power = 100
			}
		}
	}
	vn_cas_islas_canarias = {	
		icon = mission_claim_the_canaries
		completed_by = 1496.2.1
		required_missions = { }
		position = 8
		provinces_to_highlight = {
			OR = {
				province_id = 5113
				province_id = 5112
				province_id = 5111
				province_id = 5110
				province_id = 5109
				province_id = 5108
				province_id = 5107
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			5113 = { country_or_non_sovereign_subject_holds = ROOT }
			5112 = { country_or_non_sovereign_subject_holds = ROOT }
			5111 = { country_or_non_sovereign_subject_holds = ROOT }
			5110 = { country_or_non_sovereign_subject_holds = ROOT }
			5109 = { country_or_non_sovereign_subject_holds = ROOT }
			5108 = { country_or_non_sovereign_subject_holds = ROOT }
			5107 = { country_or_non_sovereign_subject_holds = ROOT }
		}
		effect = {
			5110 = {
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
		}
	}
}

vn_cas_missions_slot_3_a = {
	slot = 3
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_prepare_reconquista = {
		icon = mission_pol_varna_aftermath
		required_missions = { }
		#completed_by = 1055.1.1
		position = 1
		provinces_to_highlight = { }
		trigger = {
			OR = {
				army_size_percentage = 0.9
				army_size = 15
			}
            OR = {
                manpower_percentage = 0.9
                any_hired_mercenary_company = {
					custom_trigger_tooltip = {
						tooltip = is_free_merc_company_tt
						OR = {
							template = merc__local_free_city_company
							template = merc__local_small_company
						}
					}
				}
            }
			num_of_generals = 1
		}
		effect = {
			create_general_with_pips = {
				tradition = 40
				add_shock = 1
			}
			extremadura_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			madrid_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			toledo_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	vn_cas_continue_repoblacion = {
		icon = mission_sw_against_the_desert
		required_missions = { vn_cas_prepare_reconquista }
		position = 2
		trigger = {
			has_medium_monthly_monarch_power = { type = adm }
			if = {
				limit = {
					OR = {
						has_estate = estate_nobles
						has_estate = estate_church
						has_estate = estate_burghers
						has_estate = estate_holy_orders
					}
				}
				OR = {
					has_estate_privilege = estate_nobles_land_rights
					has_estate_privilege = estate_church_land_rights
					has_estate_privilege = estate_burghers_land_rights
					has_estate_privilege = estate_holy_orders_land_rights
				}
			}
			else = {
				stability = 3
			}
		}
		effect = {
			unlock_decision = {
                type = vn_colonize_tierra_de_nadie
            }
            add_country_modifier = {
                name = cas_continue_repoblacion_mission
                duration = 9125
            }
		}
	}
}

vn_cas_missions_slot_3_b = {
	slot = 3
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_conquer_la_mancha = {
		icon = mission_ottoman_early_army
		completed_by = 1266.1.1
		required_missions = {
			vn_cas_extremadura_campaign
			vn_cas_conquer_toledo
		}
		position = 3
		provinces_to_highlight = {
			OR = {
				area = ciudad_area
				area = cuenca_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			ciudad_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			cuenca_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		effect = {
			# ciudad_area = {
			# 	limit = { NOT = { is_core = CTL } }
			# 	add_core = CTL
			# }
			# cuenca_area = {
			# 	limit = { NOT = { is_core = CTL } }
			# 	add_core = CTL
			# }
			cordoba_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			almeria_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			murcia_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	vn_cas_capture_cordoba = {
		icon = mission_develop_cordoba
		required_missions = { vn_cas_conquer_la_mancha }
		completed_by = 1246.1.1
		provinces_to_highlight = {
			area = cordoba_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			2670 = { country_or_non_sovereign_subject_holds = ROOT }
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 6
				area = cordoba_area
			}
		}
		effect = {
			country_event = {
				id = vn_flavor_cas.1
			}


			if = {
				limit = {
					has_dlc = "Rights of Man"
					NOT = { num_of_ruler_traits = { amount = 3 } }
				}
				add_ruler_personality = matamoros_personality
			}
			else = {
				add_prestige_or_monarch_power = { amount = 10 } 

			}
			# cordoba_area = {
			# 	limit = { NOT = { is_core = CCR } }
			# 	add_core = CCR
			# }
			cordoba_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_claim_sevilla_mission"
					duration = 9125
				}
			}
			malaga_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			granada_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	vn_cas_gates_of_granada = {
		icon = mission_develop_alhambra
		completed_by = 1492.1.2
		required_missions = { 
			vn_cas_capture_cordoba
			vn_cas_claim_sevilla
			vn_cas_conquer_almeria
		}
		provinces_to_highlight = {
			OR = {
				area = malaga_area
				area = granada_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				OR = {
					area = malaga_area
					area = granada_area
				}
			}
		}
		effect = {
            country_event = {
                id = vn_flavor_cas.3
            }
			# malaga_area = {
			# 	limit = { NOT = { is_core = CGR } }
			# 	add_core = CGR
			# }
			# granada_area = {
			# 	limit = { NOT = { is_core = CGR } }
			# 	add_core = CGR
			# }
			add_prestige_or_monarch_power = { amount = 10 } 
			malaga_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_gates_of_granada_mission"
					duration = 9125
				}
			}
			granada_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_gates_of_granada_mission"
					duration = 9125
				}
			}
            if = {
                limit = { has_dlc = "Leviathan" }
                complex_dynamic_effect = {
                    first_custom_tooltip = vn_cas_gates_of_granada.tt
                    first_limit = "
                        443 = { country_or_non_sovereign_subject_holds = ROOT }
                    "
                    first_effect = "
                        443 = {
                            set_great_project_tier_2 = {
                                type = alhambra
                            }
                        }
                    "
                }
            }
            else = {
                complex_dynamic_effect = {
                    first_custom_tooltip = vn_cas_gates_of_granada.tt
                    first_limit = "
                        443 = { country_or_non_sovereign_subject_holds = ROOT }
                    "
                    first_effect = "
                        443 = {
                            add_province_modifier = {
                                name = cas_gates_of_granada_mission2
                                duration = -1
                            }
                        }
                    "
                }
            }
		}
	}
	vn_cas_triumph_over_islam = {
		icon = mission_golden_century
		completed_by = 1492.1.2
		required_missions = { vn_cas_gates_of_granada }
		provinces_to_highlight = {
			superregion = iberia_superregion
			owner = { religion_group = muslim }
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = vn_cas_triumph_over_islam.tt
				NOT = {
					any_known_country = {
						religion_group = muslim
						iberia_superregion = {
							owned_by = PREV
						}
					}
				}
			}
		}
		effect = {
			set_country_flag = fate_of_granada_mission_flag
			country_event = {
				id = flavor_spa.8
			}
			add_prestige_or_monarch_power = { amount = 10 } 
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 20
			}
			add_religious_influence_effect_small = yes
			4626 = {
				if = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
			4627 = {
				if = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
		}
	}
	vn_cas_moroccan_outposts = {
		icon = mission_moroccan_ports
		required_missions = { vn_cas_triumph_over_islam }
		position = 8
		provinces_to_highlight = {
			OR = {
				region = rif_region
				region = gharb_region
				area = taroudant_area
				area = guelmim_area
			}
			has_port = yes
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			4626 = { country_or_non_sovereign_subject_holds = ROOT }
			4627 = { country_or_non_sovereign_subject_holds = ROOT }
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 20
				has_port = yes
				OR = {
					region = rif_region
					region = gharb_region
					area = taroudant_area
					area = guelmim_area
				}
			}
		}
		effect = {
			rif_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			gharb_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			sus_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			high_atlas_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			middle_atlas_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
		}
	}
	vn_cas_riches_of_maghreb = {
		icon = mission_control_the_barbary_coast
		required_missions = { vn_cas_moroccan_outposts }
		provinces_to_highlight = {
			superregion = maghreb_superregion
			has_port = yes
			NOT = { development = 15 }
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_owned_provinces_with = {
				value = 10
				development = 15
				has_port = yes
				superregion = maghreb_superregion
			}
		}
		effect = {
			add_adm_power = 50
			coastal_tunisia_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			oran_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			saida_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			bejaia_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			constantine_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
}

vn_cas_missions_slot_4_a = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_conquer_toledo = {
		icon = mission_into_persia_2
		completed_by = 1213.1.1
		required_missions = { vn_cas_prepare_reconquista }
		position = 2
		provinces_to_highlight = {
			OR = {
				area = toledo_area
				area = madrid_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				OR = {
					area = toledo_area
					area = madrid_area
				}
			}
		}
		effect = {
			
			country_event = {
				id = vn_flavor_cas.2
			}
			# madrid_area = {
			# 	limit = { NOT = { is_core = CTL } }
			# 	add_core = CTL
			# }
			# toledo_area = {
			# 	limit = { NOT = { is_core = CTL } }
			# 	add_core = CTL
			# }
			cuenca_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			ciudad_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	vn_cas_conquer_almeria = {
		icon = mission_unite_home_region	#placeholder
		completed_by = 1492.1.2
		required_missions = { vn_cas_conquer_la_mancha }
		position = 4
		provinces_to_highlight = {
			OR = {
				area = almeria_area
				area = murcia_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				OR = {
					area = almeria_area
					area = murcia_area
				}
			}
		}
		effect = {
			# murcia_area = {
			# 	limit = { NOT = { is_core = CMU } }
			# 	add_core = CMU
			# }
			# almeria_area = {
			# 	limit = { NOT = { is_core = CGR } }
			# 	add_core = CGR
			# }
			add_adm_power = 50
			add_prestige_or_monarch_power = { amount = 5 } 
		}
	}
}

vn_cas_missions_slot_4_b = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_influence_in_occitania = {
		icon = mission_invade_occitania
		required_missions = { vn_cas_subjugate_navarra }
		position = 5
		provinces_to_highlight = {
			region = toulouse_region
			NOT = { owned_by = ROOT }
		}
		trigger = {
			OR = {
				num_of_owned_provinces_with = {
					value = 5
					region = toulouse_region
				}
				calc_true_if = {
					desc = vn_brc_influence_in_occitania.tt
					all_country = {
						capital_scope = {
							region = toulouse_region
						}
						has_opinion = {
							who = ROOT
							value = 100
						}
					}
					amount = 3
				}
			}
		}
		effect = {
			simple_dynamic_effect = {
				first_custom_tooltip = vn_brc_influence_in_occitania.tt2
				first_limit = "
					num_of_owned_provinces_with = {
						value = 5
						region = toulouse_region
					}
				"
				first_effect = "
					add_country_modifier = {
						name = brc_influence_in_occitania
						duration = 9125
					}
				"
				second_custom_tooltip = vn_brc_influence_in_occitania.tt3
				second_limit = "
					calc_true_if = {
						all_country = {
							capital_scope = {
								region = toulouse_region
							}
							has_opinion = {
								who = ROOT
								value = 150
							}
						}
						amount = 3
					}
				"
				second_effect = "
					define_advisor = {
						type = artist
						cost_multiplier = 0.25
						skill = 3
						culture = occitain
					}
				"
			}
		}
	}
}

vn_cas_missions_slot_4_c = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
		NOT = { has_country_flag = cas_inquisition_flag }
		NOT = { has_country_flag = cas_tolerance_flag }
	}

	vn_cas_branching_mission_1 = {
		icon = mission_unknown_mission
		position = 7
		required_missions = { vn_cas_triumph_over_islam }
		provinces_to_highlight = {  }

		trigger = { 
			custom_trigger_tooltip = {
				tooltip = selectable_mission_trigger_tt
				always = no
			}
		}

		effect = {
			custom_tooltip = selectable_mission_trigger_tt
		}
	}

	vn_cas_branching_mission_2 = {
		icon = mission_unknown_mission
		position = 8
		required_missions = { vn_cas_branching_mission_1 }
		provinces_to_highlight = {  }

		trigger = { 
			custom_trigger_tooltip = {
				tooltip = selectable_mission_trigger_tt
				always = no
			}
		}

		effect = {
			custom_tooltip = selectable_mission_trigger_tt
		}
	}
}

vn_cas_missions_slot_4_d = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
		has_country_flag = cas_inquisition_flag
	}
	has_country_shield = yes

	vn_cas_spanish_inquisition = {
		icon = mission_establish_jesuit_missions
		required_missions = { vn_cas_triumph_over_islam }
		position = 7
		provinces_to_highlight = {
			country_or_non_sovereign_subject_holds = ROOT
			superregion = iberia_superregion
			religion_group = muslim
		}
		trigger = {
			NOT = {
				any_owned_province = {
					superregion = iberia_superregion
					religion_group = muslim
				}
			}
			if = {
				limit = {
					any_subject_country = {
						any_owned_province = {
							superregion = iberia_superregion
						}
					}
				}
				NOT = {
					any_subject_country = {
						any_owned_province = {
							superregion = iberia_superregion
							religion_group = muslim
						}
					}
				}
			}
			NOT = { full_idea_group = humanist_ideas }
			full_idea_group = religious_ideas
		}
		effect = {
			add_country_modifier = {
				name = "cas_spanish_inquisition_mission"
				duration = 9125
			}
		}
	}
	vn_cas_assimilate_moors = {
		icon = mission_expel_the_moriscos
		required_missions = { vn_cas_spanish_inquisition }
		provinces_to_highlight = {
			country_or_non_sovereign_subject_holds = ROOT
			superregion = iberia_superregion
			culture = andalucian
		}
		trigger = {
			NOT = {
				num_of_owned_provinces_with = {
					superregion = iberia_superregion
					culture = andalucian
					value = 10
				}
			}
			if = {
				limit = {
					any_subject_country = {
						any_owned_province = {
							superregion = iberia_superregion
						}
					}
				}
				NOT = {
					any_subject_country = {
						any_owned_province = {
							superregion = iberia_superregion
							religion_group = muslim
						}
					}
				}
			}
		}
		effect = {
			add_dip_power = 50
			add_country_modifier = {
				name = "cas_assimilate_moors_mission"
				duration = 9125
			}
		}
	}
}

vn_cas_missions_slot_4_e = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_curb_barbary_piracy = {
		icon = mission_combat_barbary_piracy
		position = 9
		required_missions = { vn_cas_moroccan_outposts }
		provinces_to_highlight = {
			province_id = 1946
		}
		trigger = {
			1946 = {
				trade_share = {
					country = ROOT
					share = 25
				}
			}
			num_ships_protecting_trade = 25
		}
		effect = {
			add_country_modifier = {
				name = "cas_curb_barbary_piracy_mission"
				duration = 9125
			}
		}
	}
}

vn_cas_missions_slot_5_a = {
	slot = 5
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
	}
	has_country_shield = yes

	vn_cas_conquer_rioja = {
		icon = spa_spanish_road
		completed_by = 1076.6.4
		required_missions = { }
		position = 1
		provinces_to_highlight = {
			area = rioja_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 6
				area = rioja_area
			}
		}
		effect = {
			vizcaya_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			navarra_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	vn_cas_subjugate_navarra = {
		icon = mission_subjugate_navarra
		completed_by = 1512.7.24
		required_missions = { vn_cas_conquer_rioja }
		position = 4
		provinces_to_highlight = {
			OR = {
				area = navarra_area
				area = vizcaya_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 12
				OR = {
					area = navarra_area
					area = vizcaya_area
				}
			}
		}
		effect = {
			navarra_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_subjugate_navarra_mission"
					duration = 9125
				}
			}
			vizcaya_area = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_subjugate_navarra_mission"
					duration = 9125
				}
			}
			gascony_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}	
	}
	vn_cas_beyond_pyrenees = {
		icon = mission_wine_monopolies
		position = 6
		required_missions = { vn_cas_subjugate_navarra }
		provinces_to_highlight = {
			region = gascony_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 20
				region = gascony_region
			}
		}
		effect = {
			2324 = { add_trade_node_income = 50 }
			gascony_region = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_beyond_pyrenees_mission"
					duration = 9125
				}
			}
		}
	}
}

vn_cas_missions_slot_5_b = {
	slot = 5
	generic = no
	ai = yes
	potential = {
		OR = {
			tag = CAS
			tag = LON
			AND = {
				tag = SPA
				OR = {
					was_tag = CAS
					was_tag = LON
				}
			}
		}
		NOT = { map_setup = map_setup_random }
		has_country_flag = cas_tolerance_flag
	}
	has_country_shield = yes

	vn_cas_policy_of_tolerance = {
		icon = mission_cope_with_refugees
		required_missions = { vn_cas_triumph_over_islam }
		position = 7
		trigger = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 10
				religion_group = muslim
			}
			NOT = { full_idea_group = religious_ideas }
			full_idea_group = humanist_ideas
		}
		effect = {
			add_country_modifier = {
				name = "cas_policy_of_tolerance_mission"
				duration = 9125
			}
		}
	}
	vn_cas_cultural_renaissance = {
		icon = mission_patronize_art_and_religion
		required_missions = { vn_cas_policy_of_tolerance }
		trigger = {
			employed_advisor = {
				culture = andalucian
			}
			num_accepted_cultures = 3
			accepted_culture = andalucian
		}
		effect = {
			random_list = {
				33 = {
					define_advisor = {
						skill = 3
						type = philosopher
						culture = andalucian
						discount = yes
					}
				}
				33 = {
					define_advisor = {
						skill = 3
						type = artist
						culture = andalucian
						discount = yes
					}
				}
				33 = {
					define_advisor = {
						skill = 3
						type = natural_scientist
						culture = andalucian
						discount = yes
					}
				}
			}
			add_country_modifier = {
				name = "cas_cultural_renaissance_mission"
				duration = 9125
			}
		}
	}
}

#Rodrigo Jiménez de Rada